---
- name: Instalar o nginx
  ansible.builtin.apt:
    name: "nginx={{ nginx_version }}"
    update_cache: yes
    state: present

- name: Configurando o nginx
  ansible.builtin.copy:
    src: nginx.conf
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: 0644

- name: Create a directory if it does not exist
  ansible.builtin.file:
    path: "{{ item.destination | dirname }}"
    state: directory
    mode: '0755'
  loop: "{{ nginx_extra_conf }}"

- name: Renderizar os arquivos de configuração extras
  ansible.builtin.blockinfile:
    block: "{{ lookup('ansible.builtin.file', item.filename) }}"
    path: "{{ item.destination }}"
    create: true
  loop: "{{ nginx_extra_conf }}"

- name: Habilitando nginx
  ansible.builtin.service:
    enabled: yes
    name: nginx
    state: started
